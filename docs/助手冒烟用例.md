# 助手链路冒烟用例（手工/脚本）

以下用例用于验证“文本分类→新增交易”“规划生成→采纳”“推荐→测评→详情”三条核心链路可通。

## 准备

- 本地后端：`http://localhost:5177`（`/health` 应返回 `{ ok: true }`）
- 前端 dev 代理 `/api` 指向后端 5177 端口

## 用例 1：文本快速分类 → 新增交易

• 直接 API 方式（后端聊天网关）

PowerShell：

```powershell
$body = @{ messages = @(
  @{ role = 'system'; content = '你是票据/流水解析助手。请严格输出 JSON: {"ocr":[],"categories":[{"label":"餐饮","score":0.95}],"amount":24.5,"merchant":"沃尔玛","ts":"2024-06-12T18:30:00.000Z"}。不要输出多余文字。标签限定: 餐饮/购物/交通/娱乐/医疗/教育/住房/水电煤/工资/奖金/投资/其他。' };
  @{ role = 'user'; content = '微信支付 超市Walmart 24.50元 2024-06-12 18:30 餐饮' }
) } | ConvertTo-Json -Depth 5
Invoke-RestMethod -Method Post -Uri http://localhost:5177/api/v1/ai/chat -Body $body -ContentType 'application/json'
```

期望：`data.content` 为 JSON，包含 `amount≈24.5`、`merchant≈超市Walmart`、`categories[0].label=餐饮`。

• 前端 UI：在“票据上传”页文本框粘贴同样文本，点击“快速解析”，展示 JSON 与“去新增交易”按钮，点击跳转 `/add-transaction?date=...&amount=...&category=food`。

## 用例 2：规划生成 → 采纳

```powershell
$body = @{ target = '攒5000'; budget = 3000; deadline = '2024-12-31' } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri http://localhost:5177/api/v1/plan/generate -Body $body -ContentType 'application/json'
```

期望：`data.plans` 数组非空，规划页可显示并一键采纳（调用 `/api/v1/plans`）。

## 用例 3：产品推荐 → 风险测评 → 详情

• 推荐

```powershell
Invoke-RestMethod -Method Get -Uri 'http://localhost:5177/api/v1/products/recommend?budget=10000&termDays=180&riskPreference=MID'
```

期望：返回至少 1 条推荐；前端“为你推荐”卡片可点击。

• 风险测评

```powershell
$start = Invoke-RestMethod -Method Post -Uri http://localhost:5177/api/v1/risk/assessment/start -Body '{}' -ContentType 'application/json'
$aid = $start.data.assessmentId
$answers = @{ assessmentId = $aid; answers = @(@{ qid='q_1'; optionId='A' }, @{ qid='q_2'; optionId='B' }) } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri http://localhost:5177/api/v1/risk/assessment/submit -Body $answers -ContentType 'application/json'
```

期望：`data.level` 正常返回；前端在高风险产品点击时有风险提示弹层。

• 详情收益测算

前端打开产品详情页，输入金额 10000，显示“预期收益/到期本息”，后端优先走 `/api/v1/products/estimate`。

## 说明

- 若 AI key 未配置，AI 相关接口会走后端/前端回退逻辑；提示用户稍后再试。
- 所有接口带有限流，压测时注意节奏。
