# 智能客服：编排与工具

[返回文档索引](索引.md) · [查看智能体提示词](ai/assistant_prompts.md) · [查看后端接口](backend-api.md)

## 对话到动作（时序）

```mermaid
sequenceDiagram
  autonumber
  participant U as 用户
  participant Bot as 客服
  participant FE as 前端
  participant API as 后端
  participant DS as DeepSeek
  participant DB as 数据库

  U->>Bot: 发起请求（文字/图片）
  Bot->>FE: 需要能力：记账/分析/规划/推荐（工具调用）
  FE->>API: 调用相应 REST（/nlp、/ocr、/consumption、/planning、/products）
  API->>DS: LLM 解析/结构化（或本地 OCR→LLM）
  API->>DB: 写/读
  API-->>FE: 结果
  FE-->>Bot: 结果摘要 + 可点击入口
  Bot-->>U: 汇总与下一步建议
```

## 工具契约（摘要）

- createTransaction({ amountCent, category, note, ts, extras })
- classifyExpense({ text | ocrJson | items[] }) => { category, subCategory, confidence }
- fetchConsumptionSummary({ from,to }) => { byCategory[], trend[], frequency[] }
- fetchUserPersona() => { ageBand, incomeBand, savingRate, spendTopCategories[], riskProfile }
- planSuggestions({ goalType, budget, duration }) => { options[] }
- productRecommend({ riskPreference, termDays, amount }) => { products[], riskTips[] }

说明：系统提示与模板详见 [docs/ai/assistant_prompts.md](ai/assistant_prompts.md)。
